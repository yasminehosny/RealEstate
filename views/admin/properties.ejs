<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Properties</title>
  <link rel="stylesheet" href="/all.css">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2><i class="fa-solid fa-gauge"></i> Admin Panel</h2>
      </div>
      <nav class="sidebar-nav">
        <a href="/admin/dashboard" class="nav-item">
          <i class="fa-solid fa-chart-line"></i>
          <span>Dashboard</span>
        </a>
        <a href="/admin/users" class="nav-item">
          <i class="fa-solid fa-users"></i>
          <span>Users</span>
        </a>
        <a href="/admin/properties" class="nav-item active">
          <i class="fa-solid fa-building"></i>
          <span>Properties</span>
        </a>
        <a href="/admin/bookings" class="nav-item">
          <i class="fa-solid fa-calendar-check"></i>
          <span>Bookings</span>
        </a>
        <a href="/admin/categories" class="nav-item">
          <i class="fa-solid fa-layer-group"></i>
          <span>Categories</span>
        </a>
        <a href="/admin/feedbacks" class="nav-item">
          <i class="fa-solid fa-comments"></i>
          <span>Feedbacks</span>
        </a>
        <a href="/admin/messages" class="nav-item">
          <i class="fa-solid fa-envelope"></i>
          <span>Messages</span>
        </a>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <% if (typeof success !== 'undefined' && success) { %>
        <div id="successAlert" class="alert alert-success toast-center" style="position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(0.85); z-index:9999; min-width:320px; max-width:90vw; text-align:center; font-weight:bold; background:linear-gradient(135deg,#ede9fe 60%,#d4edda 100%); color:#333; border:2px solid #7c3aed; border-radius:18px; box-shadow:0 8px 32px rgba(79,70,229,0.18),0 2px 8px rgba(40,167,69,0.10); opacity:0; transition:opacity 0.5s cubic-bezier(.68,-0.55,.27,1.55), transform 0.5s cubic-bezier(.68,-0.55,.27,1.55); font-size:1.15rem; display:flex;align-items:center;justify-content:center;gap:12px; padding:18px 32px;">
          <% if(success==='deleted'){ %>
            <i class="fa-solid fa-trash" style="color:#ef4444;font-size:1.4em;"></i> Property deleted successfully
          <% } else if(success==='edited'){ %>
            <i class="fa-solid fa-edit" style="color:#7c3aed;font-size:1.4em;"></i> Property updated successfully
          <% } else if(success==='added'){ %>
            <i class="fa-solid fa-plus-circle" style="color:#10b981;font-size:1.4em;"></i> Property added successfully
          <% } else { %>
            <i class="fa-solid fa-check-circle" style="color:#4f46e5;font-size:1.4em;"></i> <%= success %>
          <% } %>
        </div>
        <script>
          window.addEventListener('DOMContentLoaded', function() {
            var alert = document.getElementById('successAlert');
            if(alert) {
              setTimeout(function() {
                alert.style.opacity = '1';
                alert.style.transform = 'translate(-50%,-50%) scale(1)';
              }, 100);
              setTimeout(function() {
                alert.style.opacity = '0';
                alert.style.transform = 'translate(-50%,-50%) scale(0.85)';
              }, 5000);
              setTimeout(function() {
                alert.remove();
              }, 5600);
            }
          });
        </script>
      <% } %>

      <div class="page-header">
        <div class="page-header-left">
          <h1><i class="fa-solid fa-building"></i> Properties Management</h1>
          <p>Manage all properties in the platform</p>
        </div>
        <div class="page-header-right">
          <button class="btn btn-outline" onclick="location.reload()">
            <i class="fa-solid fa-rotate"></i> Refresh
          </button>
          <form method="post" action="/admin/logout" style="display:inline;">
            <button class="btn btn-danger" type="submit">
              <i class="fa-solid fa-right-from-bracket"></i> Logout
            </button>
          </form>
          
        </div>
      </div>

      <div class="content-card">
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Property ID</th>
                <th>Property</th>
                <th>Owner ID</th>
                <th>Owner Name</th>
                <th>Category Name</th>
                <th>Price</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% properties.forEach(property => { %>
                <tr>
                  <td>
                    <span class="property-id"><%= property._id %></span>
                  </td>
                  <td>
                    <div class="property-info">
                      <div class="property-image">
                        <% if (property.images && property.images.length > 0) { %>
                          <img src="/uploads/<%= property.images[0] %>" alt="<%= property.address %>">
                        <% } else { %>
                          <i class="fa-solid fa-building"></i>
                        <% } %>
                      </div>
                      <div class="property-details">
                        <span class="property-title"><%= property.address %></span>
                        <span class="property-type"><%= property.category_name %></span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class="owner-id"><%= property.userID ? property.userID._id : 'N/A' %></span>
                  </td>
                  <td><%= property.userID ? property.userID.username : 'N/A' %></td>
                  <td><%= property.category_name || 'N/A' %></td>
                  <td>
                    <span class="price">$<%= property.price %></span>
                  </td>
                  <td><%= property.address %></td>
                  <td>
                    <span class="badge badge-<%= property.status === 'Rent' ? 'success' : 'warning' %>">
                      <%= property.status %>
                    </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <a class="btn-icon" title="View Details" href="/property/details/<%= property._id %>" target="_blank">
                        <i class="fa-solid fa-eye"></i>
                      </a>
                      
                      <form method="POST" action="/property/delete/<%= property._id %>?_method=DELETE" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this property?');">
                        <button class="btn-icon btn-danger" title="Delete Property" type="submit">
                          <i class="fa-solid fa-trash"></i>
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</body>
</html> 